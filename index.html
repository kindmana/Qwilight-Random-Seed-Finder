<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qwilight Random Seed Finder</title>
    <style>
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f2f5;
            min-height: 100vh;
        }

        .header-section {
            padding: 40px 20px;
            text-align: center;
            width: 100%;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10;
        }

        h2 { color: #333; margin-bottom: 10px; }
        
        .description {
            color: #666;
            margin-bottom: 15px;
            font-size: 15px;
            line-height: 1.6;
        }

        .notice {
            color: #d9534f;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 25px;
        }

        .input-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        input {
            padding: 12px 15px;
            width: 280px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }

        input:focus { border-color: #007bff; }

        button {
            padding: 12px 25px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
        }

        button:hover { background: #0056b3; }

        #result {
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
            color: #d9534f;
            min-height: 30px;
        }

        .image-section {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 20px 0;
        }

        .fixed-image {
            width: 60vw;
            height: auto;
            max-height: 60vh;
            object-fit: contain;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            background-color: #fff;
        }
    </style>
</head>
<body>

    <div class="header-section">
        <h2>Qwilight Random Seed Finder</h2>
        <div class="description">
            바꾸고 싶은 배치를 입력하면 시드를 찾아줍니다.<br>
            ex: 데님 제거하고 싶어요 => 1357246 입력
        </div>
        <div class="notice">
            랜덤 시드 파인더는 9키 이하의 키에서만 사용 가능합니다.
        </div>
        
        <div class="input-group">
            <input type="text" id="inputVal" placeholder="ex) 1357246" maxlength="15" onkeyup="if(window.event.keyCode==13){findSeed()}">
            <button onclick="findSeed()">시드 찾기</button>
        </div>
        
        <div id="result"></div>
    </div>

    <div class="image-section">
        <img src="image.png" alt="image.png" class="fixed-image">
    </div>

    <script>
        class DotNetRandom {
            constructor(seed) {
                this.seedArray = new Array(56);
                this.inext = 0; this.inextp = 21;
                let subtraction = (seed === -2147483648) ? 2147483647 : Math.abs(seed);
                let mj = 161803398 - subtraction;
                this.seedArray[55] = mj;
                let mk = 1;
                for (let i = 1; i < 55; i++) {
                    let ii = (21 * i) % 55;
                    this.seedArray[ii] = mk;
                    mk = mj - mk;
                    if (mk < 0) mk += 2147483647;
                    mj = this.seedArray[ii];
                }
                for (let k = 1; k < 5; k++) {
                    for (let i = 1; i < 56; i++) {
                        this.seedArray[i] -= this.seedArray[1 + (i + 30) % 55];
                        if (this.seedArray[i] < 0) this.seedArray[i] += 2147483647;
                    }
                }
            }
            next(min, max) {
                let range = max - min;
                return Math.floor(this.internalSample() * range) + min;
            }
            internalSample() {
                if (++this.inext >= 56) this.inext = 1;
                if (++this.inextp >= 56) this.inextp = 1;
                let retVal = this.seedArray[this.inext] - this.seedArray[this.inextp];
                if (retVal === 2147483647) retVal--;
                if (retVal < 0) retVal += 2147483647;
                this.seedArray[this.inext] = retVal;
                return retVal * (1.0 / 2147483647.0);
            }
        }

        function findSeed() {
            const input = document.getElementById('inputVal').value.trim();
            const resDiv = document.getElementById('result');
            
            if (!input) return;

            // --- 유효성 검사 로직 추가 ---
            const n = input.length;
            const hasDuplicate = new Set(input).size !== n; // 중복 확인
            
            if (n > 9 || hasDuplicate || isNaN(input)) {
                resDiv.innerText = "잘못된 배치입니다. 다시 입력해 주세요";
                return;
            }
            // ---------------------------

            const target = Array.from({length: n}, (_, i) => i + 1);
            resDiv.innerText = "탐색 중...";

            setTimeout(() => {
                let found = false;
                for (let seed = 0; seed < 2147483647; seed++) {
                    let rng = new DotNetRandom(seed);
                    let current = input.split('').map(Number);

                    for (let i = 0; i < n - 1; i++) {
                        let j = rng.next(i, n);
                        [current[i], current[j]] = [current[j], current[i]];
                    }

                    if (current.every((v, idx) => v === target[idx])) {
                        resDiv.innerText = "찾은 시드: " + seed;
                        found = true;
                        break;
                    }
                }
                if (!found) resDiv.innerText = "시드를 찾지 못했습니다.";
            }, 50);
        }
    </script>
</body>
</html>
